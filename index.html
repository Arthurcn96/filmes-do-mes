<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Filmes do M√™s</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0a0a0a;
      --surface: #141414;
      --border: #222;
      --accent: #e8c547;
      --text: #f0f0f0;
      --muted: #666;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      min-height: 100vh;
    }

    header {
      padding: 3rem 4rem 2rem;
      border-bottom: 1px solid var(--border);
    }

    header h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 4rem;
      letter-spacing: 2px;
      line-height: 1;
    }

    header h1 span { color: var(--accent); }

    header p {
      color: var(--muted);
      margin-top: 0.5rem;
      font-size: 0.9rem;
      font-weight: 300;
    }

    #progresso {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 0.4rem;
    }

    #conteudo {
      padding: 2rem 4rem 4rem;
    }

    .ano-bloco {
      margin-bottom: 3rem;
      opacity: 0;
      transform: translateY(16px);
      animation: fadeUp 0.35s ease forwards;
    }

    @keyframes fadeUp {
      to { opacity: 1; transform: translateY(0); }
    }

    .ano-titulo {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 2.5rem;
      color: var(--accent);
      letter-spacing: 2px;
      margin-bottom: 1.2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .ano-titulo::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    .filmes-grid {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
      padding-bottom: 0.5rem;
      scrollbar-width: thin;
      scrollbar-color: var(--border) transparent;
    }

    .card {
      flex: 0 0 140px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      overflow: hidden;
      transition: transform 0.2s, border-color 0.2s;
      position: relative;
    }

    .card:hover {
      transform: translateY(-4px);
      border-color: var(--accent);
    }

    .card > a { display: block; text-decoration: none; }

    .card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
      background: #1a1a1a;
    }

    .card-sem-poster {
      width: 100%;
      height: 200px;
      background: #1a1a1a;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
    }

    .card-info { padding: 0.6rem; }

    .card-titulo {
      font-size: 0.78rem;
      font-weight: 500;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .card-nota {
      margin-top: 0.4rem;
      font-size: 0.75rem;
      color: var(--accent);
      font-weight: 500;
    }

    .card-data {
      margin-top: 0.2rem;
      font-size: 0.7rem;
      color: var(--muted);
    }

    .tooltip {
      display: none;
      position: absolute;
      bottom: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%);
      background: #1e1e1e;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.7rem;
      width: 200px;
      font-size: 0.72rem;
      color: #ccc;
      line-height: 1.5;
      z-index: 10;
      pointer-events: none;
    }

    .card:hover .tooltip { display: block; }

    #loading {
      text-align: center;
      padding: 4rem;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 2px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    #erro {
      display: none;
      text-align: center;
      padding: 6rem;
      color: #e05;
    }

    /* ===== MOBILE ===== */
    @media (max-width: 600px) {
      header {
        padding: 2rem 1.2rem 1.5rem;
      }/
      header h1 {
        font-size: 2.5rem;
      }
      #conteudo {
        padding: 1.5rem 1.2rem 3rem;
      }

      .card img,
      .card-sem-poster {
        height: 179px;
      }
    }

    </style>
</head>
<body>

<header>
  <h1>FILMES DE <span id="mes-nome">...</span></h1>
  <p>Os 20 melhores filmes lan√ßados neste m√™s, em cada ano ‚Äî ordenados por nota.</p>
  <div id="progresso"></div>
</header>

<div id="conteudo">
  <div id="loading">
    <div class="spinner"></div>
    Carregando...
  </div>
  <div id="erro">‚ö†Ô∏è N√£o foi poss√≠vel carregar os dados.</div>
</div>

<script>
  const MESES_PT = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho",
                    "Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];

  function criarCard(filme) {
    const card = document.createElement("div");
    card.className = "card";

    const imgHtml = filme.poster
      ? `<img src="${filme.poster}" alt="${filme.titulo}" loading="lazy" />`
      : `<div class="card-sem-poster">üé¨</div>`;

    const resumo = filme.resumo
      ? filme.resumo.slice(0, 120) + (filme.resumo.length > 120 ? "‚Ä¶" : "")
      : "Sem descri√ß√£o.";

    const dataFormatada = filme.data_lancamento
      ? new Date(filme.data_lancamento + "T00:00:00").toLocaleDateString("pt-BR", { day: "2-digit", month: "short", year: "numeric" })
      : "";

    card.innerHTML = `
      <a href="${filme.link}" target="_blank" rel="noopener">${imgHtml}</a>
      <div class="card-info">
        <div class="card-titulo">${filme.titulo}</div>
        <div class="card-nota">‚≠ê ${filme.nota}</div>
        <div class="card-data">${dataFormatada}</div>
      </div>
      <div class="tooltip">${resumo}</div>
    `;
    return card;
  }

  async function carregar() {
    try {
      const res = await fetch("./cache.json");
      if (!res.ok) throw new Error();
      const cache = await res.json();

      const mes = new Date().getMonth() + 1;
      document.getElementById("mes-nome").textContent = MESES_PT[mes - 1].toUpperCase();
      document.getElementById("loading").remove();

      const anos = Object.entries(cache)
        .filter(([chave]) => chave.startsWith(`${mes}-`))
        .map(([chave, valor]) => ({
          ano: parseInt(chave.split("-")[1]),
          filmes: valor.filmes || [],
        }))
        .filter(item => item.filmes.length > 0)
        .sort((a, b) => b.ano - a.ano);

      const conteudo = document.getElementById("conteudo");

      anos.forEach((item, i) => {
        const bloco = document.createElement("div");
        bloco.className = "ano-bloco";
        bloco.style.animationDelay = `${i * 30}ms`;

        const titulo = document.createElement("div");
        titulo.className = "ano-titulo";
        titulo.textContent = item.ano;
        bloco.appendChild(titulo);

        const grid = document.createElement("div");
        grid.className = "filmes-grid";
        item.filmes.forEach(f => grid.appendChild(criarCard(f)));
        bloco.appendChild(grid);

        conteudo.appendChild(bloco);
      });

      document.getElementById("progresso").textContent = `${anos.length} anos carregados`;

    } catch (e) {
      document.getElementById("loading").remove();
      document.getElementById("erro").style.display = "block";
    }
  }

  carregar();
</script>

</body>
</html>
